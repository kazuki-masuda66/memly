# **1\. ログイン画面**

## **1.1 画面概要**

* 既存ユーザーがログインするための画面。  
* **Supabase Auth**を使用し、メールアドレス・パスワードおよびSNS(OAuth)ログインをサポート。

## **1.2 主要UI要素**

1. **メールアドレス入力欄**  
2. **パスワード入力欄** (マスク表示)  
3. **ログインボタン**  
4. **SNSログインボタン** (例: Googleでログイン)  
5. **パスワードを忘れた？** リンク  
6. **サインアップリンク** (未登録ユーザー向け)

## **1.3 機能詳細**

* **メールアドレス/パスワードバリデーション**  
* **ログインAPI呼び出し** → Supabase Auth  
* **認証成功/失敗** → 成功時トップorダッシュボードへ、失敗時エラー表示  
* **SNSログイン** → OAuthフロー → 初回はサインアップ扱い

## **1.4 画面遷移・フロー**

1. ユーザーがメール・パスワードを入力 → 「ログイン」  
2. バリデーション成功 → 認証サーバ → トップ画面遷移  
3. 「サインアップはこちら」 → **サインアップ画面**

## **1.5 入力／バリデーション**

* メール形式チェック、パスワードの空欄/長さチェック

## **1.6 注意点**

* セキュリティ: TLS必須、XSS/CSRF対策  
* SNSログインの場合、Supabase AuthがOAuthコールバック処理

---

# **2\. サインアップ画面**

## **2.1 画面概要**

* 新規ユーザーがアカウント作成するための画面。  
* メールアドレス・パスワード、またはSNS OAuthログイン。

## **2.2 主要UI要素**

1. **ユーザー名入力欄** (任意)  
2. **メールアドレス**  
3. **パスワード**  
4. **パスワード確認**  
5. **利用規約チェック**  
6. **サインアップボタン**  
7. **SNSログインボタン** (Google等)  
8. **既にアカウントをお持ちの方はこちら**(ログインへ)

## **2.3 機能詳細**

* 入力バリデーション・サインアップAPI呼び出し(Supabase Auth)  
* SNSボタン → OAuth → ユーザーを新規登録  
* 利用規約未チェック時は警告

## **2.4 画面遷移・フロー**

1. 必要事項入力 → 「登録」  
2. Supabase Auth登録成功 → ログイン状態  
3. **オンボーディング画面**へ誘導  
4. 失敗(重複メールなど) → エラー表示

## **2.5 入力／バリデーション**

* パスワード最小長など  
* パスワード確認一致

## **2.6 注意点**

* SNSサインアップの場合、パスワード欄は非表示か無視  
* 登録後にプロフィール情報(`profiles`)を作成

---

# **3\. オンボーディング（初回スライド）**

## **3.1 画面概要**

* 初回ログイン時のみ表示し、Memlyの使い方や特徴をスライド形式で案内。  
* スキップ可能。

## **3.2 主要UI要素**

1. **スライド** (数枚)  
2. **次へ・戻る**ボタン or スワイプ操作  
3. **スキップ/完了**ボタン

## **3.3 機能詳細**

* スライドに**AI生成**・**学習モード**・**間隔反復**などの概要を紹介  
* 「完了」or「スキップ」で`onboarding_completed`をtrueに更新

## **3.4 画面遷移・フロー**

1. ログイン後、`onboarding_completed=false`の場合に表示  
2. ユーザーが完了 → **トップ画面**へ  
   

---

# **4\. Topの学習画（デイリーダッシュボード）**

## **4.1 画面概要**

* 当日学習すべきカード数や正答率、連続学習日数等を表示。  
* ここから「今日の学習開始」ボタンで学習モードへ進む。

## **4.2 主要UI要素**

1. **今日の学習カード数**  
2. **正答率・連続学習日数**  
3. **学習ボタン**  
4. **苦手カード数** などオプション

## **4.3 機能詳細**

* 日々の学習タスクを可視化  
* 「学習開始」→ 学習モード選択 or 直接学習画面  
* データはstudy\_logs・user\_card\_stats等で集計

## **4.4 画面遷移・フロー**

1. アプリ起動 → 本画面をメインに表示  
2. 「学習開始」押下 → 学習モード選択画面

## **4.5 注意点**

* 更新タイミングで最新の集計を取得  
* モチベ維持のためUI演出(ゲージなど)

---

# **5\. 学習モード選択画面**

## **5.1 画面概要**

* 学習開始時に「一問一答 / 4択 / 正誤問題」などの形式を選択。  
* 4択・正誤問題は都度AI生成を行う（Stripeクレジット消費）。

## **5.2 主要UI要素**

1. **モード切り替え** (ラジオボタン/タブ)  
2. **AIクレジット残高**  
3. **学習開始ボタン**  
4. (詳細オプション) 時間制限など

## **5.3 機能詳細**

* モード決定 → API呼び出し (`/api/startSession`) → session作成  
* 4択/正誤問題なら誤答選択肢生成でAIクレジット消費

## **5.4 画面遷移・フロー**

1. 「学習開始」押下 → モード選択 → 「スタート」  
2. Edge Function → sessionID発行 → **学習画面**  
3. 戻る→ Topダッシュボード

## **5.5 注意点**

* クレジット不足時は**サブスク/クレジット購入**画面へ誘導

---

# **6\. 学習画面（カードをめくるUI）**

## **6.1 画面概要**

* フラッシュカードの実際の出題・回答を行う。  
* 問題文（表面）→ 回答表示（裏面）→ ログ登録 → 次カード。

## **6.2 主要UI要素**

1. **カード表面** (問題文)  
2. **カード裏面** (解答,補足情報)  
3. **選択肢**(4択・正誤モードのみ)  
4. **進捗バー** (「3/15」など)  
5. **正解/不正解** or 「回答確定」ボタン  
6. **次へ**ボタン

## **6.3 機能詳細**

* **回答ログ** → `study_logs`にinsert  
* 一問一答は自己申告(正答or誤答)  
* 4択/正誤はAIからの正答を参照→ 判定

## **6.4 画面遷移・フロー**

1. 学習開始時にAPIで最初のカード取得  
2. 回答 → 正誤をサーバ送信 → 次カード取得  
3. 全問終了 → 学習完了画面

## **6.5 注意点**

* 4択の場合、都度AIで誤答生成 or 学習開始時にまとめて生成  
* ユーザーが中断→ session status='canceled'？

---

# **7\. カード生成画面（多彩なソース）**

## **7.1 画面概要**

* ユーザーがテキスト/ファイル/URL等をアップロードし、AIでカードを生成。  
* Stripeクレジットを消費して大量生成→プレビュー後確定。

## **7.2 主要UI要素**

1. **ソース入力**:  
   * ファイルアップロード(音声/PDF等)  
   * URL入力(YouTube,Website)  
   * テキストエリア  
2. **生成設定**:  
   * 問題数,難易度,言語など  
3. **生成ボタン**(クレジット消費表示)  
4. **生成結果プレビュー**(カード一覧)  
5. **編集ボタン**(カード単体編集)  
6. **確定ボタン**(一括登録→デッキ)

## **7.3 機能詳細**

* アップロード→OCR/音声認識等→テキスト抽出  
* Vercel AI SDKで問題/回答生成→ `temp_generated_cards`に保存  
* ユーザーがプレビューで編集→不要カード削除→「確定」→ `flashcards`へ移動

## **7.4 画面遷移・フロー**

1. ユーザーがソース選択 \+ 生成設定 → 「生成」  
2. API呼び出し→AI生成→プレビュー表示  
3. 不要カードを削除/編集→「確定」  
4. デッキを指定→一括登録→**デッキ詳細**画面へ

## **7.5 注意点**

* 大容量ファイル処理の待ち時間  
* Stripeクレジット残が足りない場合→ サブスク/クレジット購入画面へ

---

# **8\. デッキ管理画面**

### **8.1 デッキ一覧画面**

#### **8.1.1 画面概要**

* 所有するデッキの一覧を表示。新規デッキ作成、削除、並び替えなど。

#### **8.1.2 主要UI要素**

1. **デッキ一覧** (タイトル、カード数、最終学習日時など)  
2. **ソート/フィルター** (作成日順,正答率順など)  
3. **新規デッキ作成ボタン**  
4. **学習開始** (複数選択で学習する場合も想定)

#### **8.1.3 機能詳細**

* デッキ一覧取得 → status='hidden'は非表示or折り畳み  
* 新規作成 → モーダルでデッキ名入力 → INSERT  
* タップで**デッキ詳細画面**へ

### **8.2 デッキ詳細画面**

#### **8.2.1 画面概要**

* 選択したデッキ内のカードを閲覧・編集・追加。

#### **8.2.2 主要UI要素**

1. **デッキ名表示** \+ 編集  
2. **カード一覧** (問題文プレビュー,正答率など)  
3. **カード追加**ボタン  
4. **カード編集/削除**アイコン  
5. **学習開始** ボタン

#### **8.2.3 機能詳細**

* カード一覧表示 → 選択で編集モーダル  
* カードを削除→ `deleted_flag=true`  
* 「カード追加」 → AI生成or手動追加  
* 「学習開始」→ セッション生成

---

# **9\. ダッシュボード画面（総合分析）**

## **9.1 画面概要**

* 長期的な学習データをグラフや統計で可視化。  
* 苦手カード、忘却曲線予測など。

## **9.2 主要UI要素**

1. **累計学習数/累計正答数**  
2. **週/月/累計 正答率推移グラフ**  
3. **苦手カードTOP N**  
4. **忘却曲線予測**(最適復習日)

## **9.3 機能詳細**

* グラフ描画: DBから日次集計  
* 苦手カード: user\_card\_statsをdifficulty順でソート  
* クリック→該当カードの編集や再学習導線

## **9.4 注意点**

* 集計負荷対策 (マテリアライズドビューなど)  
* UIが複雑にならぬようメリハリ

---

# **10\. 検索画面**

## **10.1 画面概要**

* デッキ・カードをキーワードや条件で検索。

## **10.2 主要UI要素**

1. **キーワード入力**  
2. **条件フィルタ** (デッキ, 学習状態, 日付範囲など)  
3. **検索ボタン**  
4. **結果リスト**(デッキ/カード)

## **10.3 機能詳細**

* フリーテキスト検索(全文検索インデックス)  
* 状態(苦手/未学習など)絞り込み  
* 検索結果クリック→ デッキ詳細 or カード編集画面

---

# **11\. 設定画面**

## **11.1 画面概要**

* 通知設定やUIテーマ、パスワード変更、退会などアカウント設定をまとめた画面。

## **11.2 主要UI要素**

1. **通知設定**(リマインドオン/オフ \+ 時刻)  
2. **UIテーマ**(ライト/ダーク)  
3. **言語**(ja/en等)  
4. **パスワード変更**(Supabase Auth)  
5. **退会ボタン**(deleted\_flagをtrueなど)

## **11.3 機能詳細**

* `/api/userSettings`呼び出しで更新  
* パスワード変更→Supabase Auth  
* 退会時→ `profiles.deleted_flag=true` or `auth.users`削除

---

# **12\. サブスクリプション画面 (Stripe決済)**

## **12.1 画面概要**

* **有料プラン**(Pro/Unlimited等)や**追加クレジット購入**を行う画面。  
* **Stripe**を利用した決済フロー。

## **12.2 主要UI要素**

1. **プラン一覧** (価格, 月額/年額)  
2. **現在のプラン情報** (status, 次回請求日, クレジット残量)  
3. **「購入/アップグレード」ボタン**  
4. **追加クレジット購入**ボタン (任意)  
5. **解約/ダウングレード**ボタン

## **12.3 機能詳細**

* **Stripe決済フロー**  
  1. ユーザーが「購入」ボタン → Edge Functionsで**Stripe Checkout Session**を作成  
  2. 成功→Webhook or リダイレクトで通知を受け、`user_subscriptions`と`user_credits`更新  
* **プラン比較**: 付与クレジット、機能制限  
* **現在プラン**: `user_subscriptions` を参照

## **12.4 画面遷移・フロー**

1. ユーザーが「サブスク管理」を選択 → 現在プラン＆候補プラン一覧表示  
2. 「購入」→ Edge Functionで**Stripe Checkout**へリダイレクト  
3. 支払い成功→ StripeのWebhook→Edge Function→DB (`user_subscriptions`をactiveに)  
4. フロントをリダイレクト→ 「購入完了」画面

## **12.5 入力／バリデーション**

* ユーザーの支払い手段(カード登録など)はStripe側で安全に処理  
* エラー(決済拒否)時はエラー表示

## **12.6 注意点**

* **Webhook**設定: Stripe → Edge Functions  
* **アップグレード/ダウングレード**の料金調整  
* **月額/年額**切り替えで計算ロジックに差異

